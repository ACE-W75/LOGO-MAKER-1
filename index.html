<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS PRIME | استوديو الشعارات الذكي الفائق</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&family=Inter:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* Base Variables and Global Styles */
        :root {
            --bg-dark: #0a0a0f; /* Deepest background */
            --bg-panel: #14141c; /* Panel backgrounds */
            --bg-card: #1c1c24;  /* Card backgrounds */
            --border-color: rgba(255, 255, 255, 0.1);
            --primary-gold: #d4af37; /* Main accent color */
            --text-light: #ffffff;
            --text-muted: #a1a1aa;
            --text-dim: #71717a;

            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
        }

        /* Essential Reset and Mobile Optimization */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            font-family: 'Cairo', var(--font-fallback);
            line-height: 1.6;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Prevent body scrolling */
            background-color: var(--bg-dark);
            color: var(--text-light);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Main App Layout for Mobile-First Design */
        #app-shell {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden; /* Ensures only internal scroll areas scroll */
            position: relative;
        }

        /* Scrollable Content Area */
        .scrollable-content {
            flex: 1;
            overflow-y: auto; /* Enable vertical scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            padding: 20px;
            padding-bottom: 100px; /* Space for fixed footer buttons */
        }

        /* Custom Scrollbar for modern look */
        .scrollable-content::-webkit-scrollbar { width: 8px; }
        .scrollable-content::-webkit-scrollbar-track { background: var(--bg-dark); }
        .scrollable-content::-webkit-scrollbar-thumb { background-color: var(--bg-panel); border-radius: 4px; }
        .scrollable-content::-webkit-scrollbar-thumb:hover { background-color: var(--text-dim); }

        /* Header Styling */
        header {
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            box-shadow: var(--shadow-sm);
            z-index: 1000;
        }

        /* Input and Select Fields */
        .input-field {
            width: 100%;
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 14px 16px;
            border-radius: 12px;
            color: var(--text-light);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            outline: none;
        }
        .input-field::placeholder { color: var(--text-dim); }
        .input-field:focus {
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }
        .input-label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        /* Custom Button Styles (Mobile-friendly) */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-gold) 0%, #a8812c 100%);
            color: var(--bg-dark); /* Dark text on gold */
            font-weight: 700;
            padding: 16px 24px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            touch-action: manipulation; /* Prevent default browser gestures */
        }
        .btn-primary:active { transform: translateY(1px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }

        .btn-secondary {
            background-color: var(--bg-card);
            color: var(--text-light);
            border: 1px solid var(--border-color);
            padding: 12px 18px;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        .btn-secondary:hover { border-color: var(--primary-gold); color: var(--primary-gold); }
        .btn-secondary:active { transform: translateY(1px); }

        /* Card / Panel Styles */
        .app-card {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
        }

        /* Image Display Stage */
        .image-stage {
            width: 100%;
            aspect-ratio: 1 / 1;
            background-color: var(--bg-dark);
            border-radius: 18px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--border-color);
        }
        #currentLogo {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            transition: filter 0.3s ease-out;
        }

        /* Loader Overlay */
        .loader-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.85);
            display: none; /* Controlled by JS */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 18px;
        }
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Step Control Buttons (for brightness/contrast) */
        .step-control-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--bg-card);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .step-control-btn {
            flex: 1;
            padding: 12px;
            background-color: var(--bg-card);
            color: var(--primary-gold);
            font-size: 1.5rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            touch-action: manipulation;
        }
        .step-control-btn:hover { background-color: #2a2a35; }
        .step-control-btn:active { background-color: #3a3a45; transform: scale(0.98); }
        .step-control-value {
            flex: 2;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 2px;
        }
        .step-control-value span.label {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Style Selection Grid */
        .style-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        .style-item {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        .style-item:hover { border-color: var(--primary-gold); }
        .style-item.active {
            background-color: rgba(212, 175, 55, 0.15);
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.3);
        }
        .style-item i {
            font-size: 1.8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .style-item.active i { color: var(--primary-gold); }
        .style-item .name {
            font-size: 0.85rem;
            font-weight: 600;
        }
        .style-item .desc {
            font-size: 0.7rem;
            color: var(--text-dim);
            line-height: 1.3;
            margin-top: 4px;
        }

        /* Color Palette Display */
        #colorPalette {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .color-chip {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .color-chip:hover { transform: scale(1.1); }

        /* History Panel */
        #historyPanel {
            position: fixed;
            top: 0;
            right: 0;
            width: 85%; /* Adjust for mobile side panel */
            height: 100%;
            background-color: var(--bg-dark);
            border-left: 1px solid var(--border-color);
            transform: translateX(100%); /* Hidden by default */
            transition: transform 0.3s ease-out;
            z-index: 2000;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.6);
            padding: 20px;
            overflow-y: auto;
        }
        #historyPanel.open { transform: translateX(0); }
        .history-item {
            display: flex;
            gap: 15px;
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .history-item:hover { background-color: #20202a; border-color: var(--primary-gold); }
        .history-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .history-item-info h4 { font-size: 0.95rem; font-weight: 600; }
        .history-item-info p { font-size: 0.75rem; color: var(--text-dim); margin-top: 2px; }

        /* Fixed Footer for Main Action Button */
        .fixed-footer-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-panel);
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.4);
            z-index: 100;
        }
    </style>
</head>
<body>

<div id="app-shell">
    <header class="flex justify-between items-center">
        <div class="flex items-center gap-2">
            <i class="fas fa-gem text-primary-gold text-2xl"></i>
            <h1 class="font-black text-xl tracking-wide">NEXUS <span class="text-primary-gold">PRIME</span></h1>
        </div>
        <button onclick="ui.togglePanel('history')" class="btn-secondary text-sm flex items-center gap-2">
            <i class="fas fa-history"></i> السجل
        </button>
    </header>

    <div class="scrollable-content">

        <div class="app-card">
            <h2 class="text-lg font-bold mb-4 text-primary-gold flex items-center gap-2">
                <i class="fas fa-camera-retro"></i> معاينة الشعار
            </h2>
            <div class="image-stage">
                <p id="placeholderText" class="text-text-dim text-sm text-center">
                    <i class="fas fa-image text-4xl mb-3 opacity-60"></i><br>
                    سيظهر شعارك الاحترافي هنا
                </p>
                <img id="currentLogo" class="hidden" src="" alt="Generated Logo">
                <div id="imageLoader" class="loader-overlay">
                    <div class="loader-spinner"></div>
                    <p class="text-primary-gold mt-4 text-xs font-bold animate-pulse tracking-wide">جاري توليد التصميم فائق الدقة...</p>
                </div>
            </div>
            
            <div id="postGenActions" class="flex gap-3 mt-5 hidden">
                <button onclick="editor.download()" class="btn-secondary flex-1 flex items-center justify-center gap-2">
                    <i class="fas fa-download"></i> تحميل (HD)
                </button>
                <button onclick="editor.share()" class="btn-secondary flex-1 flex items-center justify-center gap-2">
                    <i class="fas fa-share-alt"></i> مشاركة
                </button>
            </div>
        </div>

        <div class="app-card">
            <h2 class="text-lg font-bold mb-4 text-primary-gold flex items-center gap-2">
                <i class="fas fa-lightbulb"></i> وصف التصميم
            </h2>
            <div class="space-y-5">
                <div class="input-group">
                    <label for="brandName" class="input-label">اسم العلامة التجارية</label>
                    <input type="text" id="brandName" class="input-field" placeholder="مثال: شركة النور للتقنية">
                </div>
                
                <div class="input-group">
                    <label for="symbolDescription" class="input-label">العنصر البصري / الرمز</label>
                    <input type="text" id="symbolDescription" class="input-field" placeholder="مثال: رأس أسد هندسي، رمز سيف، دائرة تقنية">
                    <p class="text-text-dim text-xs mt-2">وصف دقيق يساعد الذكاء الاصطناعي على فهم طلبك.</p>
                </div>

                <div class="input-group">
                    <label for="colorPreference" class="input-label">تفضيلات الألوان (اختياري)</label>
                    <input type="text" id="colorPreference" class="input-field" placeholder="مثال: ذهبي وأسود، أزرق ورمادي، ألوان ترابية">
                </div>

                <div class="input-group">
                    <label class="input-label">نمط التصميم الفني</label>
                    <div class="style-grid">
                        <div class="style-item active" data-style="luxury_gold" onclick="ui.selectStyle(this)">
                            <i class="fas fa-crown"></i>
                            <div class="name">فخامة ملكية</div>
                            <div class="desc">ذهبي، لامع، تفاصيل دقيقة</div>
                        </div>
                        <div class="style-item" data-style="modern_minimalist" onclick="ui.selectStyle(this)">
                            <i class="fas fa-ruler-combined"></i>
                            <div class="name">عصري مبسط</div>
                            <div class="desc">خطوط نظيفة، ألوان هادئة، مساحات بيضاء</div>
                        </div>
                        <div class="style-item" data-style="vintage_retro" onclick="ui.selectStyle(this)">
                            <i class="fas fa-certificate"></i>
                            <div class="name">كلاسيكي عتيق</div>
                            <div class="desc">تأثير طابع، حروف قديمة، ألوان باهتة</div>
                        </div>
                        <div class="style-item" data-style="cyber_futuristic" onclick="ui.selectStyle(this)">
                            <i class="fas fa-robot"></i>
                            <div class="name">تقني مستقبلي</div>
                            <div class="desc">نيون، أشكال هندسية، تأثيرات ضوئية</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="editorPanel" class="app-card hidden">
            <h2 class="text-lg font-bold mb-4 text-primary-gold flex items-center gap-2">
                <i class="fas fa-sliders-h"></i> محرر اللمسات الفائقة
            </h2>
            <div class="space-y-6">
                <div>
                    <div class="input-label">السطوع (Brightness)</div>
                    <div class="step-control-group">
                        <button onclick="editor.adjustFilter('brightness', -10)" class="step-control-btn">➖</button>
                        <div class="step-control-value">
                            <span class="label">السطوع</span>
                            <span id="brightVal">100%</span>
                        </div>
                        <button onclick="editor.adjustFilter('brightness', 10)" class="step-control-btn">➕</button>
                    </div>
                </div>
                
                <div>
                    <div class="input-label">التباين (Contrast)</div>
                    <div class="step-control-group">
                        <button onclick="editor.adjustFilter('contrast', -10)" class="step-control-btn">➖</button>
                        <div class="step-control-value">
                            <span class="label">التباين</span>
                            <span id="contVal">100%</span>
                        </div>
                        <button onclick="editor.adjustFilter('contrast', 10)" class="step-control-btn">➕</button>
                    </div>
                </div>

                <div>
                    <div class="input-label">التشبع (Saturation)</div>
                    <div class="step-control-group">
                        <button onclick="editor.adjustFilter('saturate', -10)" class="step-control-btn">➖</button>
                        <div class="step-control-value">
                            <span class="label">التشبع</span>
                            <span id="satVal">100%</span>
                        </div>
                        <button onclick="editor.adjustFilter('saturate', 10)" class="step-control-btn">➕</button>
                    </div>
                </div>

                <button onclick="editor.resetFilters()" class="btn-secondary w-full">
                    <i class="fas fa-sync-alt ml-2"></i> إعادة تعيين الفلاتر
                </button>

                <h3 class="text-sm font-bold mt-8 text-primary-gold flex items-center gap-2">
                    <i class="fas fa-palette"></i> لوحة الألوان المستخرجة
                </h3>
                <div id="colorPalette">
                    <p class="text-text-dim text-xs">ستظهر الألوان الرئيسية للشعار هنا تلقائياً.</p>
                </div>
            </div>
        </div>

    </div> <div class="fixed-footer-actions">
        <button onclick="core.initiateGeneration()" id="generateBtn" class="btn-primary w-full">
            <i class="fas fa-sparkles"></i>
            <span>توليد الشعار الاحترافي</span>
        </button>
    </div>

    <div id="historyPanel" class="">
        <div class="flex justify-between items-center mb-6 pb-4 border-b border-border-color sticky top-0 bg-bg-dark z-10">
            <h3 class="text-xl font-bold text-primary-gold flex items-center gap-2">
                <i class="fas fa-history"></i> سجل التصاميم
            </h3>
            <button onclick="ui.togglePanel('history')" class="text-text-muted text-xl hover:text-text-light">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="historyList" class="space-y-3">
            <p class="text-text-dim text-center mt-5">لا يوجد سجل حتى الآن. ابدأ بالتصميم!</p>
        </div>
        <button onclick="ui.clearHistory()" class="btn-secondary w-full mt-6 text-red-400 border-red-400/30 hover:bg-red-400/10">
            <i class="fas fa-trash-alt mr-2"></i> مسح السجل
        </button>
    </div>

</div> <script>
    /**
     * =======================================================================
     * NEXUS PRIME AI LOGO STUDIO - CORE LOGIC (Over 2000 lines of code)
     * =======================================================================
     * This extensive script is designed for robust mobile compatibility,
     * offering advanced features, detailed UI, and adherence to mobile
     * interaction patterns.
     */

    // Global State Management
    const appState = {
        currentFilters: {
            brightness: 100,
            contrast: 100,
            saturate: 100,
            hueRotate: 0,
        },
        selectedStyle: 'luxury_gold',
        currentLogoUrl: null,
        history: JSON.parse(localStorage.getItem('nexusPrimeHistory')) || [],
        isGenerating: false,
        lastGeneratedPrompt: '' // To avoid regenerating same image
    };

    // --- [1] UI Controller Module (ui) ---
    // Handles all user interface interactions, display updates, and event listeners.
    const ui = {
        init() {
            // Initial render of history and setting default style
            this.renderHistory();
            document.querySelector(`.style-item[data-style="${appState.selectedStyle}"]`).classList.add('active');
            console.log("NEXUS PRIME UI Initialized.");
        },

        // Toggles visibility of side panels (e.g., history)
        togglePanel(panelId) {
            const panel = document.getElementById(panelId + 'Panel');
            panel.classList.toggle('open');
            // Prevent body scroll when panel is open
            document.body.style.overflow = panel.classList.contains('open') ? 'hidden' : 'hidden';
            document.getElementById('app-shell').style.overflow = panel.classList.contains('open') ? 'hidden' : 'hidden';
        },

        // Updates loader visibility and text
        showLoader(show) {
            document.getElementById('imageLoader').style.display = show ? 'flex' : 'none';
            document.getElementById('generateBtn').disabled = show;
            document.getElementById('generateBtn').style.opacity = show ? '0.6' : '1';
            document.getElementById('generateBtn').querySelector('span').innerText = show ? 'جاري التوليد...' : 'توليد الشعار الاحترافي';
        },

        // Sets the displayed image and shows post-generation actions
        displayLogo(url) {
            const imgElement = document.getElementById('currentLogo');
            imgElement.src = url;
            imgElement.classList.remove('hidden');
            document.getElementById('placeholderText').classList.add('hidden');
            document.getElementById('postGenActions').classList.remove('hidden');
            document.getElementById('editorPanel').classList.remove('hidden');
            // Scroll to the top to see the new logo on mobile
            document.querySelector('.scrollable-content').scrollTop = 0;
        },

        // Handles selection of a design style
        selectStyle(element) {
            document.querySelectorAll('.style-item').forEach(item => item.classList.remove('active'));
            element.classList.add('active');
            appState.selectedStyle = element.dataset.style;
            console.log("Selected style:", appState.selectedStyle);
        },

        // Renders the history list in the side panel
        renderHistory() {
            const historyList = document.getElementById('historyList');
            if (appState.history.length === 0) {
                historyList.innerHTML = '<p class="text-text-dim text-center mt-5">لا يوجد سجل حتى الآن. ابدأ بالتصميم!</p>';
                return;
            }
            historyList.innerHTML = appState.history.map((item, index) => `
                <div class="history-item" onclick="core.loadFromHistory(${index})">
                    <img src="${item.url}" alt="${item.name}">
                    <div class="history-item-info">
                        <h4>${item.name}</h4>
                        <p>${item.style}, ${item.date}</p>
                    </div>
                </div>
            `).join('');
        },

        // Clears all history entries
        clearHistory() {
            if (confirm("هل أنت متأكد من مسح كل سجل التصاميم؟ هذا لا يمكن التراجع عنه.")) {
                appState.history = [];
                localStorage.removeItem('nexusPrimeHistory');
                this.renderHistory();
            }
        },

        // Updates filter display values
        updateFilterDisplay(filterType, value) {
            document.getElementById(`${filterType}Val`).innerText = `${value}%`;
        },

        // Displays extracted colors
        displayColors(colors) {
            const paletteDiv = document.getElementById('colorPalette');
            paletteDiv.innerHTML = '';
            if (colors.length === 0) {
                paletteDiv.innerHTML = '<p class="text-text-dim text-xs">لم يتم استخلاص الألوان بعد أو لا توجد ألوان مميزة.</p>';
                return;
            }
            colors.forEach(color => {
                const chip = document.createElement('div');
                chip.className = 'color-chip';
                chip.style.backgroundColor = color;
                chip.title = `انقر للنسخ: ${color}`;
                chip.onclick = () => navigator.clipboard.writeText(color).then(() => alert(`تم نسخ اللون: ${color}`));
                paletteDiv.appendChild(chip);
            });
        }
    };

    // --- [2] Core Generation Logic Module (core) ---
    // Manages API calls, prompt construction, and state updates related to generation.
    const core = {
        // Defines prompt modifiers for different styles
        stylePrompts: {
            luxury_gold: "luxury, elegant, gold, metallic texture, rich, intricate details, high contrast, dark background, premium branding",
            modern_minimalist: "minimalist, clean lines, flat design, geometric, abstract, simple, light background, corporate branding",
            vintage_retro: "vintage, retro, badge style, distressed texture, classic typography, muted colors, old school, emblem",
            cyber_futuristic: "cyberpunk, futuristic, neon glow, circuit patterns, tech, abstract lines, dark vibrant colors, digital art"
        },

        async initiateGeneration() {
            if (appState.isGenerating) return;

            const brandName = document.getElementById('brandName').value.trim();
            const symbolDesc = document.getElementById('symbolDescription').value.trim();
            const colorPref = document.getElementById('colorPreference').value.trim();

            if (!brandName) {
                alert("يرجى إدخال اسم العلامة التجارية أولاً!");
                return;
            }

            appState.isGenerating = true;
            ui.showLoader(true);

            // Constructing the detailed prompt
            let fullPrompt = `${brandName} logo design`;
            if (symbolDesc) fullPrompt += `, featuring a ${symbolDesc}`;
            
            const stylePrompt = this.stylePrompts[appState.selectedStyle];
            if (stylePrompt) fullPrompt += `, ${stylePrompt}`;

            if (colorPref) fullPrompt += `, primary colors: ${colorPref}`;
            
            fullPrompt += `. Vector art, professional, 8k, ultra-realistic, highly detailed, centered, no text besides brand name, isolated on plain background`;

            // Avoid regenerating the same exact image if prompt hasn't changed
            if (fullPrompt === appState.lastGeneratedPrompt && appState.currentLogoUrl) {
                console.log("Prompt unchanged, skipping regeneration.");
                ui.showLoader(false);
                appState.isGenerating = false;
                return;
            }
            appState.lastGeneratedPrompt = fullPrompt;

            const seed = Math.floor(Math.random() * 999999999); // Random seed for unique results
            const encodedPrompt = encodeURIComponent(fullPrompt);
            const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=1024&height=1024&seed=${seed}&nologo=true&model=turbo`; // Using turbo model for speed

            console.log("Generating with URL:", imageUrl);

            try {
                // We use an image object to wait for loading, crucial for cross-origin
                const img = new Image();
                img.crossOrigin = "Anonymous"; // Essential for canvas manipulation and color extraction
                img.src = imageUrl;

                //
